package br.unisantos.pce.service;

import java.io.IOException;
import java.io.Writer;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVPrinter;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import br.unisantos.pce.model.Anamnese;
import br.unisantos.pce.model.Retorno;

@Service
public class FormularioService {
    private List<Anamnese> anamneses;
    private List<Retorno> retornos;
    private AnamneseService anamneseService;
    private RetornoService retornoService;

    @Autowired
    public FormularioService(AnamneseService anamneseService, RetornoService retornoService) {
        this.anamneseService = anamneseService;
        this.retornoService = retornoService;
    }

    public void exportAnamneseToCSV(Writer writer) throws IOException {
        this.anamneses = new ArrayList<Anamnese>(anamneseService.listarAnamneses());

        try (CSVPrinter printer = new CSVPrinter(writer,
                CSVFormat.DEFAULT.builder().setHeader(
                        "id",
                        "pacienteNome",
                        "usuarioNome",
                        "tipoFormulario",
                        "escolaridade",
                        "periodoEstudo",
                        "lancheEstudo",
                        "periodoTrabalho",
                        "lancheTrabalho",
                        "profissao",
                        "rendaFamiliar",
                        "numPessoasDomicilio",
                        "motivo",
                        "apresentaDoenca",
                        "antecedentesFamiliares",
                        "medicamentosContinuos",
                        "suplementosComplementos",
                        "frequenciaEvacuacao",
                        "consistenciaEvacuacao",
                        "praticaAtvFisica",
                        "atvFisica",
                        "cafeDaManha",
                        "lancheDaManha",
                        "almoco",
                        "lancheDaTarde",
                        "jantar",
                        "ceia",
                        "legumesCenoura",
                        "legumesBeterraba",
                        "legumesBerinjela",
                        "legumesPepino",
                        "legumesAbobrinha",
                        "legumesChuchu",
                        "legumesTomate",
                        "verdurasAcelga",
                        "verdurasAgriao",
                        "verdurasAlface",
                        "verdurasBrocolis",
                        "verdurasChicoria",
                        "verdurasCouveManteiga",
                        "verdurasCouveFlor",
                        "verdurasEspinafre",
                        "verdurasRucula",
                        "frutasCLaranja",
                        "frutasCTangerina",
                        "frutasCLimao",
                        "frutasCAbacaxi",
                        "frutasCAcerola",
                        "frutasCMorango",
                        "frutasCKiwi",
                        "frutasCMaracuja",
                        "demaisFrutasBanana",
                        "demaisFrutasGoiaba",
                        "demaisFrutasMaca",
                        "demaisFrutasMamao",
                        "demaisFrutasManga",
                        "demaisFrutasMelancia",
                        "demaisFrutasMelao",
                        "demaisFrutasPera",
                        "demaisFrutasPessego",
                        "demaisFrutasUva",
                        "leguminosasFeijao",
                        "leguminosasLentilha",
                        "leguminosasErvilha",
                        "leguminosasSoja",
                        "leguminosasGraoDeBico",
                        "leguminosasVagem",
                        "carnesBovina",
                        "carnesSuina",
                        "carnesAves",
                        "carnesPeixe",
                        "frutosDoMar",
                        "ovo",
                        "arrozBrancoPolido",
                        "arrozIntegral",
                        "lacteosLeiteIntegralDesnatadoSemi",
                        "lacteosLeiteSemLactose",
                        "lacteosQueijosPedacoOuFatia",
                        "lacteosIogurtes",
                        "cereaisAveia",
                        "cereaisGranolaInNatura",
                        "cereaisQuinoa",
                        "cereaisLinhaca",
                        "cereaisChia",
                        "paesFrancesMediaNormal",
                        "paesFrancesMediaIntegral",
                        "paesForma",
                        "paesFormaIntegral",
                        "paesCara",
                        "pastasRequeijao",
                        "pastasMargarina",
                        "pastasManteiga",
                        "pastasRicota",
                        "pastasCottage",
                        "pastasDoceDeLeite",
                        "pastasCremeDeAvela",
                        "pastasGeleia",
                        "salgadosMistinhoEsfiha",
                        "salgadosCoxinhaCroquete",
                        "salgadosEmpadas",
                        "salgadosPaoDeQueijo",
                        "ultraprocessadosSalgadinhoDePacote",
                        "ultraprocessadosBiscoitoSalgado",
                        "ultraprocessadosBiscoitoDoce",
                        "ultraprocessadosChocolate",
                        "ultraprocessadosRefrigerante",
                        "ultraprocessadosSucoEmPoCaixinha",
                        "ultraprocessadosPratosProntosCongelados",
                        "ultraprocessadosMacarraoInstantaneo",
                        "ultraprocessadosBolinho",
                        "ultraprocessadosFastFood",
                        "embutidosSalame",
                        "embutidosPresunto",
                        "embutidosApresuntadoMortadela",
                        "embutidosLinguicaToscanaCalabresa",
                        "embutidosSalsicha",
                        "embutidosPeitoDePeru",
                        "embutidosRosbife",
                        "embutidosNuggets",
                        "embutidosHamburguerTradicional",
                        "acucaresAcucar",
                        "acucaresAdocante",
                        "acucaresMelMelado",
                        "acucaresProdutosConfeitaria",
                        "acucaresGuloseimas",
                        "acucaresAchocolatados",
                        "molhosKetchup",
                        "molhosMostarda",
                        "molhosShoyu",
                        "molhosTare",
                        "molhosMaionese",
                        "quemCozinha",
                        "necessidadeComerEstressadoAnsiosoTriste",
                        "realizaRefeicoesSozinhoAcompanhado",
                        "excessoAlimentosNaoSaudaveisSintomas",
                        "dificuldadeRotinaAlimentarSaudavel",
                        "necessidadeConsoloAlimentar",
                        "dificuldadePararDeComer",
                        "frequenciaFomeFisiologica",
                        "frequenciaNecessidadeEmocionalComer",
                        "naoModificarPlanoAlimentar",
                        "aversaoAlimentar",
                        "toleraAlimentosProteinaAnimal",
                        "alergiaIntoleranciasAlimentares",
                        "notaSaciedadePosRefeicoes",
                        "notaHumorPosRefeicoes",
                        "pesoAtual",
                        "estatura",
                        "imc",
                        "cb",
                        "dct",
                        "dcb",
                        "dcse",
                        "dcsi",
                        "somatoria4Dobras",
                        "porcentagemGorduraCorporalSomatoria4Dobras",
                        "pesoGordura",
                        "pesoMassaMagra",
                        "totalAgua",
                        "porcentagemAguaMassaMagra",
                        "resistencia",
                        "reactancia",
                        "anguloDeFase",
                        "circunferenciaCintura",
                        "circunferenciaQuadril",
                        "circunferenciaPanturrilha",
                        "emapDireita",
                        "emapEsquerda",
                        "forcaPreencaoManualDireita",
                        "forcaPreencaoManualEsquerda",
                        "metas",
                        "criadoEm")
                        .build());) {

            for (Anamnese anamnese : anamneses) {
                printer.printRecord(
                        anamnese.getId(),
                        anamnese.getPacienteNome(),
                        anamnese.getUsuarioNome(),
                        anamnese.getTipoFormulario(),
                        anamnese.getEscolaridade(),
                        anamnese.getPeriodoEstudo(),
                        anamnese.getLancheEstudo(),
                        anamnese.getPeriodoTrabalho(),
                        anamnese.getLancheTrabalho(),
                        anamnese.getProfissao(),
                        anamnese.getRendaFamiliar(),
                        anamnese.getNumPessoasDomicilio(),
                        anamnese.getMotivo(),
                        anamnese.getApresentaDoenca(),
                        anamnese.getAntecedentesFamiliares(),
                        anamnese.getMedicamentosContinuos(),
                        anamnese.getSuplementosComplementos(),
                        anamnese.getFrequenciaEvacuacao(),
                        anamnese.getConsistenciaEvacuacao(),
                        anamnese.getPraticaAtvFisica(),
                        anamnese.getAtvFisica(),
                        anamnese.getCafeDaManha(),
                        anamnese.getLancheDaManha(),
                        anamnese.getAlmoco(),
                        anamnese.getLancheDaTarde(),
                        anamnese.getJantar(),
                        anamnese.getCeia(),
                        anamnese.getLegumesCenoura(),
                        anamnese.getLegumesBeterraba(),
                        anamnese.getLegumesBerinjela(),
                        anamnese.getLegumesPepino(),
                        anamnese.getLegumesAbobrinha(),
                        anamnese.getLegumesChuchu(),
                        anamnese.getLegumesTomate(),
                        anamnese.getVerdurasAcelga(),
                        anamnese.getVerdurasAgriao(),
                        anamnese.getVerdurasAlface(),
                        anamnese.getVerdurasBrocolis(),
                        anamnese.getVerdurasChicoria(),
                        anamnese.getVerdurasCouveManteiga(),
                        anamnese.getVerdurasCouveFlor(),
                        anamnese.getVerdurasEspinafre(),
                        anamnese.getVerdurasRucula(),
                        anamnese.getFrutasCLaranja(),
                        anamnese.getFrutasCTangerina(),
                        anamnese.getFrutasCLimao(),
                        anamnese.getFrutasCAbacaxi(),
                        anamnese.getFrutasCAcerola(),
                        anamnese.getFrutasCMorango(),
                        anamnese.getFrutasCKiwi(),
                        anamnese.getFrutasCMaracuja(),
                        anamnese.getDemaisFrutasBanana(),
                        anamnese.getDemaisFrutasGoiaba(),
                        anamnese.getDemaisFrutasMaca(),
                        anamnese.getDemaisFrutasMamao(),
                        anamnese.getDemaisFrutasManga(),
                        anamnese.getDemaisFrutasMelancia(),
                        anamnese.getDemaisFrutasMelao(),
                        anamnese.getDemaisFrutasPera(),
                        anamnese.getDemaisFrutasPessego(),
                        anamnese.getDemaisFrutasUva(),
                        anamnese.getLeguminosasFeijao(),
                        anamnese.getLeguminosasLentilha(),
                        anamnese.getLeguminosasErvilha(),
                        anamnese.getLeguminosasSoja(),
                        anamnese.getLeguminosasGraoDeBico(),
                        anamnese.getLeguminosasVagem(),
                        anamnese.getCarnesBovina(),
                        anamnese.getCarnesSuina(),
                        anamnese.getCarnesAves(),
                        anamnese.getCarnesPeixe(),
                        anamnese.getFrutosDoMar(),
                        anamnese.getOvo(),
                        anamnese.getArrozBrancoPolido(),
                        anamnese.getArrozIntegral(),
                        anamnese.getLacteosLeiteIntegralDesnatadoSemi(),
                        anamnese.getLacteosLeiteSemLactose(),
                        anamnese.getLacteosQueijosPedacoOuFatia(),
                        anamnese.getLacteosIogurtes(),
                        anamnese.getCereaisAveia(),
                        anamnese.getCereaisGranolaInNatura(),
                        anamnese.getCereaisQuinoa(),
                        anamnese.getCereaisLinhaca(),
                        anamnese.getCereaisChia(),
                        anamnese.getPaesFrancesMediaNormal(),
                        anamnese.getPaesFrancesMediaIntegral(),
                        anamnese.getPaesForma(),
                        anamnese.getPaesFormaIntegral(),
                        anamnese.getPaesCara(),
                        anamnese.getPastasRequeijao(),
                        anamnese.getPastasMargarina(),
                        anamnese.getPastasManteiga(),
                        anamnese.getPastasRicota(),
                        anamnese.getPastasCottage(),
                        anamnese.getPastasDoceDeLeite(),
                        anamnese.getPastasCremeDeAvela(),
                        anamnese.getPastasGeleia(),
                        anamnese.getSalgadosMistinhoEsfiha(),
                        anamnese.getSalgadosCoxinhaCroquete(),
                        anamnese.getSalgadosEmpadas(),
                        anamnese.getSalgadosPaoDeQueijo(),
                        anamnese.getUltraprocessadosSalgadinhoDePacote(),
                        anamnese.getUltraprocessadosBiscoitoSalgado(),
                        anamnese.getUltraprocessadosBiscoitoDoce(),
                        anamnese.getUltraprocessadosChocolate(),
                        anamnese.getUltraprocessadosRefrigerante(),
                        anamnese.getUltraprocessadosSucoEmPoCaixinha(),
                        anamnese.getUltraprocessadosPratosProntosCongelados(),
                        anamnese.getUltraprocessadosMacarraoInstantaneo(),
                        anamnese.getUltraprocessadosBolinho(),
                        anamnese.getUltraprocessadosFastFood(),
                        anamnese.getEmbutidosSalame(),
                        anamnese.getEmbutidosPresunto(),
                        anamnese.getEmbutidosApresuntadoMortadela(),
                        anamnese.getEmbutidosLinguicaToscanaCalabresa(),
                        anamnese.getEmbutidosSalsicha(),
                        anamnese.getEmbutidosPeitoDePeru(),
                        anamnese.getEmbutidosRosbife(),
                        anamnese.getEmbutidosNuggets(),
                        anamnese.getEmbutidosHamburguerTradicional(),
                        anamnese.getAcucaresAcucar(),
                        anamnese.getAcucaresAdocante(),
                        anamnese.getAcucaresMelMelado(),
                        anamnese.getAcucaresProdutosConfeitaria(),
                        anamnese.getAcucaresGuloseimas(),
                        anamnese.getAcucaresAchocolatados(),
                        anamnese.getMolhosKetchup(),
                        anamnese.getMolhosMostarda(),
                        anamnese.getMolhosShoyu(),
                        anamnese.getMolhosTare(),
                        anamnese.getMolhosMaionese(),
                        anamnese.getQuemCozinha(),
                        anamnese.getNecessidadeComerEstressadoAnsiosoTriste(),
                        anamnese.getRealizaRefeicoesSozinhoAcompanhado(),
                        anamnese.getExcessoAlimentosNaoSaudaveisSintomas(),
                        anamnese.getDificuldadeRotinaAlimentarSaudavel(),
                        anamnese.getNecessidadeConsoloAlimentar(),
                        anamnese.getDificuldadePararDeComer(),
                        anamnese.getFrequenciaFomeFisiologica(),
                        anamnese.getFrequenciaNecessidadeEmocionalComer(),
                        anamnese.getNaoModificarPlanoAlimentar(),
                        anamnese.getAversaoAlimentar(),
                        anamnese.getToleraAlimentosProteinaAnimal(),
                        anamnese.getAlergiaIntoleranciasAlimentares(),
                        anamnese.getNotaSaciedadePosRefeicoes(),
                        anamnese.getNotaHumorPosRefeicoes(),
                        anamnese.getPesoAtual(),
                        anamnese.getEstatura(),
                        anamnese.getImc(),
                        anamnese.getCb(),
                        anamnese.getDct(),
                        anamnese.getDcb(),
                        anamnese.getDcse(),
                        anamnese.getDcsi(),
                        anamnese.getSomatoria4Dobras(),
                        anamnese.getPorcentagemGorduraCorporalSomatoria4Dobras(),
                        anamnese.getPesoGordura(),
                        anamnese.getPesoMassaMagra(),
                        anamnese.getTotalAgua(),
                        anamnese.getPorcentagemAguaMassaMagra(),
                        anamnese.getResistencia(),
                        anamnese.getReactancia(),
                        anamnese.getAnguloDeFase(),
                        anamnese.getCircunferenciaCintura(),
                        anamnese.getCircunferenciaQuadril(),
                        anamnese.getCircunferenciaPanturrilha(),
                        anamnese.getEmapDireita(),
                        anamnese.getEmapEsquerda(),
                        anamnese.getForcaPreencaoManualDireita(),
                        anamnese.getForcaPreencaoManualEsquerda(),
                        anamnese.getMetas(),
                        anamnese.getCriadoEm());
            }

        } catch (IOException e) {
            throw new IOException("Erro ao gerar o CSV", e);
        }
    }

    public void exportRetornoToCSV(Writer writer) throws IOException {
        this.retornos = new ArrayList<Retorno>(retornoService.listarRetornos());

        try (CSVPrinter printer = new CSVPrinter(writer,
                CSVFormat.DEFAULT.builder().setHeader(
                        "id",
                        "pacienteId",
                        "pacienteNome",
                        "usuarioId",
                        "usuarioNome",
                        "tipoFormulario",
                        "retorno",
                        "metasUltimasConsultas",
                        "comentariosObservacao",
                        "metasForamCumpridas",
                        "desempenhoCumprimentoMetas",
                        "motivoAssinaladoCumprimentoMetas",
                        "comoSentiuMudancaHabitos",
                        "adaptacaoMudancaHabitos",
                        "motivosDificuldadeAdaptacao",
                        "sentePrecisaMelhorarAlimentacao",
                        "habitoIntestinal",
                        "atvFisica",
                        "metasProximoRetorno",
                        "pesoAtual",
                        "imc",
                        "circunferenciaAbdominal",
                        "valoresBioimpedancia",
                        "observacoesBioimpedancia",
                        "criadoEm")
                        .build());) {

            for (Retorno retorno : retornos) {
                printer.printRecord(
                        retorno.getId(),
                        retorno.getPacienteId(),
                        retorno.getPacienteNome(),
                        retorno.getUsuarioId(),
                        retorno.getUsuarioNome(),
                        retorno.getTipoFormulario(),
                        retorno.getMetasUltimasConsultas(),
                        retorno.getComentariosObservacao(),
                        retorno.getMetasForamCumpridas(),
                        retorno.getDesempenhoCumprimentoMetas(),
                        retorno.getMotivoAssinaladoCumprimentoMetas(),
                        retorno.getComoSentiuMudancaHabitos(),
                        retorno.getAdaptacaoMudancaHabitos(),
                        retorno.getMotivosDificuldadeAdaptacao(),
                        retorno.getSentePrecisaMelhorarAlimentacao(),
                        retorno.getHabitoIntestinal(),
                        retorno.getAtvFisica(),
                        retorno.getMetasProximoRetorno(),
                        retorno.getPesoAtual(),
                        retorno.getImc(),
                        retorno.getCircunferenciaAbdominal(),
                        retorno.getValoresBioimpedancia(),
                        retorno.getObservacoesBioimpedancia(),
                        retorno.getCriadoEm());
            }

        } catch (IOException e) {
            throw new IOException("Erro ao gerar o CSV", e);
        }
    }
}
